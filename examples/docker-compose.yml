# Docker Compose example for remarkable-sync
#
# This runs remarkable-sync in daemon mode, syncing documents every hour.
#
# Usage:
#   1. First, authenticate:
#      docker-compose run --rm remarkable-sync auth
#
#   2. Start the daemon:
#      docker-compose up -d
#
#   3. View logs:
#      docker-compose logs -f
#
#   4. Stop the daemon:
#      docker-compose down

version: '3.8'

services:
  remarkable-sync:
    image: ghcr.io/platinummonkey/remarkable-sync:latest
    container_name: remarkable-sync
    restart: unless-stopped

    # Volumes for persistent data
    volumes:
      # reMarkable API credentials (created during auth)
      - ./credentials:/home/remarkable/.rmapi

      # Output directory for synced documents
      - ./output:/output

    # Run in daemon mode, syncing every hour
    command: >
      daemon
      --interval 1h
      --output /output
      --log-level info

    # Optional: Health check
    healthcheck:
      test: ["CMD", "pgrep", "remarkable-sync"]
      interval: 5m
      timeout: 10s
      retries: 3
      start_period: 10s

    # Optional: Resource limits
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M

# Example with labels filter
#
# To sync only documents with specific labels:
#
# services:
#   remarkable-sync:
#     image: ghcr.io/platinummonkey/remarkable-sync:latest
#     volumes:
#       - ./credentials:/home/remarkable/.rmapi
#       - ./output:/output
#     command: >
#       daemon
#       --interval 1h
#       --output /output
#       --labels "work,personal"

# Example with custom health endpoint
#
# services:
#   remarkable-sync:
#     image: ghcr.io/platinummonkey/remarkable-sync:latest
#     ports:
#       - "8080:8080"
#     volumes:
#       - ./credentials:/home/remarkable/.rmapi
#       - ./output:/output
#     command: >
#       daemon
#       --interval 1h
#       --output /output
#       --health-addr :8080
#     healthcheck:
#       test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
#       interval: 1m
#       timeout: 5s
#       retries: 3
